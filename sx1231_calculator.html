<!DOCTYPE HTML> <html> <head> <!-- Copyright (c) 2019 David Imhoff <dimhoff.devel <at> gmail.com> Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. --> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <title>SX1231 Calculator</title> <style type="text/css" media="screen"> body{ counter-reset:figures;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;color:#333;}h1{ border-bottom:1px solid #e5e5e5;}.page{ width:650px;margin:auto;}#svgSpectrum{ position:relative;left:50%;width:98vw;margin-left:-49vw;}.InputDiv{ margin:10px;}.InputDiv label{ width:300px;display:inline-block;vertical-align:middle;}.InputDiv input[type='number'], .InputDiv input[type='text']{ width:280px;}.InputDiv select{ width:300px;}.hidden{ display:none;}.hiddenUnlimitedLen{ display:none;} #pageRegistersDebug{ display:none; position:fixed;top:0px;right:0px;height:100%;border-left:3px solid grey;text-align:center;overflow-y:scroll;}#pageRegistersDebug h1{ margin:0px;}#pageRegistersDebug table{ font-size:10px;}#pageRegistersDebug table .highlight{ background:lightgrey;}#pageRegistersDebug textarea{ height:100%;}figure{ margin-left:0px;margin-right:0px;}figcaption{ font-style:italic;}figcaption::before{ counter-increment:figures;content:"Fig. " counter(figures) ":";}#PktView{ width:100%;border-collapse:collapse;text-align:center;}#PktView .PktViewCell{ border:1px solid #333;display:table-cell;vertical-align:middle;padding:5px;}.PktViewFieldLabel{ font-weight:bold;}table.DioTable{ border-collapse:collapse;}table.DioTable tbody tr td:first-child{ width:25px;}table.DioTable tbody tr td{ width:150px;text-align:center;}table.DioTable tbody tr.selected{ background:aliceblue;}table.DioTable tbody tr.selected:hover{ background:lightblue;}table.DioTable tbody tr:hover{ background:ghostwhite;cursor:pointer;}#title{ font-size:42px;font-weight:bold;text-align:center;}#divCopyright{ position:fixed;bottom:0px;left:0px;margin:5px;border-radius:5px; width:1em;overflow:hidden;white-space:nowrap;transition:all 1s ease-in;}#divCopyright:hover{ width:420px;background-color:white;}</style> </head> <body> <div id="title">SX1231 Calculator</div> <form id="frmSettings" action="javascript:void(0);"> <div class="page"> <h1>Generic</h1> <div class="InputDiv"> <label for="inpFXO">Oscillator Frequency (MHz)</label> <input id="inpFXO" name="fxo" type="number" min="26" max="32" step="0.000001" value="32" required> </div> <div class="InputDiv"> <label for="outFStep">FSTEP</label> <output id="outFStep" name="fstep" for="inpFXO"> </output></div> <div class="InputDiv"> <label for="cbxTcxoInputOn">Use External Clock Instead of Crystal</label> <input id="cbxTcxoInputOn" name="tcxo_input_on" type="checkbox"> </div> </div> <div class="page"> <h1>Radio</h1> <div class="InputDiv"> <label for="selRadioModulation">Modulation</label> <select id="selRadioModulation" name="modulation" required> <option value="0" selected>FSK</option> <option value="1">OOK</option> </select> </div> <div class="InputDiv"> <label for="inpRadioCarrierFreq">Carrier Frequency (MHz)</label> <input id="inpRadioCarrierFreq" name="carrier_freq" type="number" min="290" max="1020" step="0.000001" value="915" required> </div> <div class="FSKOnly"> <div class="InputDiv"> <label for="inpRadioFreqDev">FSK Frequency Deviation (kHz)</label> <!-- NOTE: constraint: FDEV + bitrate/2 =< 500 kHz is always met due to limited range of FDev(300k) and BitRate(300k) --> <input id="inpRadioFreqDev" name="fdev" type="number" min="0.6" max="300" step="0.001" value="5" required> </div> <div class="InputDiv"> <label for="outRadioModulationIndex">Modulation Index, &beta;=</label> <output id="outRadioModulationIndex" name="modulation_index" for="inpRadioFreqDev inpPayloadBitRate"> </output></div> </div> </div> <div class="page"> <h1>Transmitter</h1> <div class="InputDiv"> <label for="selTXPinSelect">Power Amplifier Selection</label> <select id="selTXPinSelect" name="tx_pin_select" required> <option value="0" selected>PA0 on pin RFIO</option> <option value="1">PA1 &amp; PA2 on pin PA_BOOST</option> </select> </div> <div class="InputDiv"> <label for="inpTXPAPower">Output amplification</label> <input id="inpTXPAPower" name="pa_power" type="number" min="-18" max="17" step="1" value="13"> <!-- NOTE: See 3.4.6 PA0: -18 + (0-31) = -18 t/m 13 dBm PA1: -18 + (0-31) = -18 t/m 13 dBm PA1+PA2: -14 + (16-31) = 2 t/m 17 dBm (This only makes sense for > 13 dBm, below PA1 is more efficient.) --> </div> <div class="InputDiv"> <!-- TODO: disable this for OOK????? register description says only for FSK, But 3.4.5 suggests this is also for OOK --> <label for="selTXPARamp">PA Ramp rise/full time</label> <select id="selTXPARamp" name="pa_ramp" required> <option value="0">3.4 ms</option> <option value="1">2 ms</option> <option value="2">1 ms</option> <option value="3">500 us</option> <option value="4">250 us</option> <option value="5">125 us</option> <option value="6">100 us</option> <option value="7">62 us</option> <option value="8">50 us</option> <option value="9" selected>40 us</option> <option value="10">31 us</option> <option value="11">25 us</option> <option value="12">20 us</option> <option value="13">15 us</option> <option value="14">12 us</option> <option value="15">10 us</option> </select> </div> <div class="InputDiv"> <label for="selTXModulationShaping">Modulation Shaping</label> <select id="selTXModulationShaping" name="modulation_shaping" required> <!-- Filled based on selected Modulation --> </select> </div> <div class="InputDiv"> <label for="cbxTXOCPOn">Enable Over-Current Protection</label> <input id="cbxTXOCPOn" name="ocp_on" type="checkbox" checked> </div> <div id="settingsTXOCP" class="InputDiv"> <label for="inpTXOCPIMax">Max. Current (mA)</label> <input id="inpTXOCPIMax" name="ocp_imax" type="number" min="45" max="120" step="5" value="95" required> </div> </div> <div class="page"> <h1>Receiver</h1> <h2>LNA</h2> <div class="InputDiv"> <label for="selRXLNAZin">LNA input impedance</label> <select id="selRXLNAZin" name="lna_zin" required> <option value="0">50 Ohm</option> <option value="1" selected>200 Ohm</option> </select> </div> <div class="InputDiv"> <label for="selRXLNAGain">LNA gain setting</label> <select id="selRXLNAGain" name="lna_gain_select" required> <option value="0" selected>Automatic</option> <option value="1">Max. Gain</option> <option value="2">Max. – 6 dB</option> <option value="3">Max. – 12 dB</option> <option value="4">Max. – 24 dB</option> <option value="5">Max. – 36 dB</option> <option value="6">Max. – 48 dB</option> </select> </div> <div class="InputDiv"> <label for="cbxRXContDAGC">Continuous Digital AGC</label> <input id="cbxRXContDAGC" name="dagc_on" type="checkbox" checked> </div> <div class="InputDiv"> <label for="cbxRXSensitivityBoost">Enable Sensitivity Boost</label> <input id="cbxRXSensitivityBoost" name="sensitivity_boost" type="checkbox"> </div> <!-- TODO: Maybee generate Figure 8 with the correct numbers (see 3.5.3.2 for AGC reference value) --> <h2>Band Filter</h2> <div class="InputDiv"> <label for="selRxBw">Single Side Channel Bandwidth (kHz)</label> <select id="selRxBw" name="rx_bw" required> </select> <!-- TODO: contraint: BitRate < 2 x RxBw --> </div> <div class="InputDiv FSKOnly"> <label for="selRXDccFreq">DC Cancelation cut-off Frequency</label> <select id="selRXDccFreq" name="dcc_freq" required> <option value="0">15.92 % of RxBw</option> <option value="1">7.96 % of RxBw</option> <option value="2" selected>3.98 % of RxBw</option> <option value="3">1.99 % of RxBw</option> <option value="4">0.99 % of RxBw</option> <option value="5">0.50 % of RxBw</option> <option value="6">0.25 % of RxBw</option> <option value="7">0.12 % of RxBw</option> </select> </div> <h2>AFC</h2> <div class="InputDiv"> <label for="inpRxAfcBw">Single Side Channel Bandwidth for AFC (kHz)</label> <select id="selRxAfcBw" name="afc_bw" required> </select> </div> <div class="InputDiv FSKOnly"> <label for="selRXDccFreqAfc">AFC DC Cancelation cut-off Frequency</label> <select id="selRXDccFreqAfc" name="dcc_freq_afc" required> <option value="0">15.92 % of RxBw</option> <option value="1">7.96 % of RxBw</option> <option value="2">3.98 % of RxBw</option> <option value="3">1.99 % of RxBw</option> <option value="4" selected>0.99 % of RxBw</option> <option value="5">0.50 % of RxBw</option> <option value="6">0.25 % of RxBw</option> <option value="7">0.12 % of RxBw</option> </select> </div> <div class="InputDiv"> <label for="cbxRXAfcAutoOn">Auto Start AFC on RX</label> <input id="cbxRXAfcAutoOn" name="afc_auto_on" type="checkbox"> </div> <div class="InputDiv"> <label for="cbxRXAfcAutoClearOn">Clear error on AFC start</label> <input id="cbxRXAfcAutoClearOn" name="afc_auto_clear_on" type="checkbox"> </div> <div id="settingsLowBeta"> <!-- TODO: constraint: only if modulation index < 2--> <div class="InputDiv"> <label for="cbxRXAfcLowBeta">Optimize AFC for low modulation index</label> <input id="cbxRXAfcLowBeta" name="afc_low_beta_on" type="checkbox"> </div> <div id="settingsAfcLowBeta" class="InputDiv"> <label for="inpRXAfcLowBetaOffset">Low modulation index optimalization offset (Hz)</label> <input id="inpRXAfcLowBetaOffset" name="low_beta_afc_offset" type="number" min="0" max="124440" step="488" value="0" required> </div> </div><!--END: id="settingsLowBeta"--> <h2>Demodulator</h2> <div class="InputDiv"> <label>RSSI Threshold (dBm)</label> <input id="inpRXRssiThreshold" name="rssi_threshold" type="number" min="-127.5" max="0" step="0.5" value="-114" required> </div> <div class="OOKOnly"> <div class="InputDiv"> <label for="selDemodOokThreshType">OOK Threshold Type</label> <select id="selDemodOokThreshType" name="ook_thresh_type" required> <option value="0">Fixed</option> <option value="1" selected>Peak</option> <option value="2">Average</option> </select> </div> <!-- TODO: maybee add a figure like 'figure 11' to illustrate threshold meaning and settings --> <div id="settingsOokPeakThreshold"> <div class="InputDiv"> <label for="selDemodOokPeakThreshStep">Threshold decay step</label> <select id="selDemodOokPeakThreshStep" name="ook_peak_thresh_step" required> <option value="0" selected>0.5 dB</option> <option value="1">1.0 dB</option> <option value="2">1.5 dB</option> <option value="3">2.0 dB</option> <option value="4">3.0 dB</option> <option value="5">4.0 dB</option> <option value="6">5.0 dB</option> <option value="7">6.0 dB</option> </select> </div> <div class="InputDiv"> <label for="selDemodOokPeakThreshDec">Threshold decay time</label> <select id="selDemodOokPeakThreshDec" name="ook_peak_thresh_dec" required> <option value="0" selected>once per chip</option> <option value="1">once every 2 chips</option> <option value="2">once every 4 chips</option> <option value="3">once every 8 chips</option> <option value="4">twice in each chip</option> <option value="5">4 times in each chip</option> <option value="6">8 times in each chip</option> <option value="7">16 times in each chip</option> </select> </div> <div class="InputDiv"> <!-- TODO: this is actually duplicate of setting below for fixed threshold level --> <label for="inpDemodOokPeakThreshFloor">Threshold noise floor level (dB)</label> <input id="inpDemodOokPeakThreshFloor" name="ook_peak_thresh_floor" type="number" min="0" max="255" step="1" value="6" required> </div> </div> <div id="settingsOokAverageThreshold"> <div class="InputDiv"> <label for="selDemodOokAverageThreshFilter">Threshold filter coefficient</label> <!-- TODO: verify the parentheses below the devision line are correct?? and that the point before the pi sign is indeed a multiplication --> <select id="selDemodOokAverageThreshFilter" name="ook_average_thresh_fit" required> <option value="0">f_C ≈ chip rate / (32 * &pi;)</option> <option value="1">f_C ≈ chip rate / (8 * &pi;)</option> <option value="2" selected>f_C ≈ chip rate / (4 * &pi;)</option> <option value="3">f_C ≈ chip rate / (2 * &pi;)</option> </select> </div> </div> <div id="settingsOokFixedThreshold"> <div class="InputDiv"> <label for="inpDemodOokFixedThreshLevel">Threshold level (dB)</label> <input id="inpDemodOokFixedThreshLevel" name="ook_fixed_thresh" type="number" min="0" max="255" step="1" value="6" required> </div> </div> </div> </div> <div class="page"> <h1>Payload</h1> <div class="InputDiv"> <label for="inpPayloadBitRate">Bit Rate (kbit/s)</label> <input id="inpPayloadBitRate" name="wanted_bit_rate" type="number" min="1.2" max="300" step="0.001" value="4.8" required> </div> <div class="InputDiv"> <label for="outPayloadActualBitRate">Actual Bit Rate (bit/s)</label> <output id="outPayloadActualBitRate" name="bit_rate"> </output></div> <div class="InputDiv"> <label for="selDataMode">Data Operation Mode</label> <select id="selDataMode" name="data_mode" required> <option value="0">Packet Mode</option> <option value="1">Continuous Mode</option> </select> </div> <div class="InputDiv ContModeOnly"> <label for="cbxContModeBitSync">Enable Bit Synchronizer</label> <input id="cbxContModeBitSync" name="bit_sync_on" type="checkbox" checked> </div> </div> <div class="page PktModeOnly"> <h1>Packet Handeling</h1> <h2>Packet Format</h2> <div class="InputDiv"> <label for="inpPktPreambleSize">Preamble Length (Byte)</label> <input id="inpPktPreambleSize" name="preamble_size" type="number" min="0" max="65535" value="3" required> </div> <div class="InputDiv"> <label for="cbxPktSyncOn">Enable Sync Word</label> <input id="cbxPktSyncOn" name="sync_on" type="checkbox" checked> </div> <div id="syncWordSettings"> <div class="InputDiv"> <label for="inpPktSyncSize">Sync Word Length (Byte)</label> <input id="inpPktSyncSize" name="sync_size" type="number" min="1" max="8" value="4" required> </div> <div class="InputDiv"> <label for="inpPktSyncValue">Sync Word</label> <input id="inpPktSyncValue" name="sync_value" type="text" minlength="2" maxlength="16" pattern="([0-9A-Fa-f]{2})+" value="01010101"> </div> <div class="InputDiv"> <label for="inpPktSyncTol">Sync Word max. bit errors</label> <input id="inpPktSyncTol" name="sync_tol" type="number" min="0" max="7" value="0" required> </div> </div> <div class="InputDiv"> <label for="selPktFormat">Packet Format</label> <select id="selPktFormat" name="packet_format" required> <option value="0" selected>Fixed Length</option> <option value="1">Variable Length</option> <option value="2">Unlimited Length</option> </select> </div> <div id="pktLenSettings" class="InputDiv"> <label id="lblPktLenFixed" for="inpPayloadLen">Payload Message Length (Byte)<br>(excl. address byte)</label> <label id="lblPktLenVar" for="inpPayloadLen">Max. RX Payload Message Length (Byte)<br>(excl. length and address bytes)</label> <input id="inpPayloadLen" name="payload_msg_len" type="number" min="0" max="255" value="64" required> </div> <!-- TODO: If unlimited length packets(pkt_var_len = false && payload_len = 0) there are extra constraints on manchester/whitening encoding, CRC checks and address filtering see par. 5.5.2.3 --> <!-- TODO: if variable length packets and payload_len == 255 then the length byte will not be in the fifo (par 5.5.7.3) --> <div class="InputDiv hideIfUnlimitedLenWithoutSync"> <label for="selPktEncoding">Encoding</label> <select id="selPktEncoding" name="encoding" required> <option value="0" selected>None</option> <option value="1">Manchester</option> <option value="2">Whitening</option> </select> </div> <div class="InputDiv"> <label for="cbxPktCrcOn">Enable CRC-16-CCITT checksum<span id="lblCrcTxOnly"> (TX Only)</span></label> <input id="cbxPktCrcOn" name="crc_on" type="checkbox" checked> </div> <div class="hideIfUnlimitedLen"> <div id="pktCrcSettings" class="InputDiv"> <label for="cbxPktCrcAutoClearOff">Do not clear FIFO on CRC error</label> <input id="cbxPktCrcAutoClearOff" name="crc_auto_clear_off" type="checkbox"> </div> </div><!-- class="hideIfUnlimitedLen" --> <div class="hideIfUnlimitedLenWithoutSync"> <div class="InputDiv"> <label for="selPktAddrFilt">Address Filtering</label> <select id="selPktAddrFilt" name="address_filtering" required> <option value="0" selected>None</option> <option value="1">Node Address</option> <option value="2">Node + Broadcast Address</option> </select> </div> <div id="pktNodeAddrSettings" class="InputDiv"> <label for="inpPktNodeAddr">Node Address (0-255)</label> <input id="inpPktNodeAddr" name="node_address" type="number" min="0" max="255" value="0" required> </div> <div id="pktBcastAddrSettings" class="InputDiv"> <label for="inpPktBcastAddr">Broadcast Address (0-255)</label> <input id="inpPktBcastAddr" name="broadcast_address" type="number" min="0" max="255" value="0" required> </div> </div><!-- class="hideIfUnlimitedLenWithoutSync" --> <div class="hideIfUnlimitedLen"> <div class="InputDiv"> <label for="cbxPktAesOn">Enable AES-128 Encryption</label> <input id="cbxPktAesOn" name="aes_on" type="checkbox"> </div> <div id="pktAesSettings" class="InputDiv"> <label for="inpPktAesKey">AES Key</label> <input id="inpPktAesKey" name="aes_key" type="text" minlength="32" maxlength="32" pattern="[0-9A-Fa-f]{32}" placeholder="hexadecimal key (ie. 001122...ddeeff)" required> </div> </div><!-- class="hideIfUnlimitedLen" --> <figure> <div id="PktView"> <div id="PktViewPreamble" class="PktViewCell"> <div class="PktViewFieldLabel">Preamble</div> <!-- TODO: verify that preamble is 0xAA and not 0x55 --> <span id="lblPktPreambleLen">10</span> x '0xAA' </div> <div id="PktViewSync" class="PktViewCell"> <div class="PktViewFieldLabel">Sync. Word</div> <span id="lblPktSyncValue"> 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 </span> </div> <div id="PktViewEncoded" class="PktViewCell"> <div style="text-align:left;width:100%;font-style:italic;"><span id="lblPktEncoding">Manchester</span>:</div> <div id="PktViewPayload" class="PktViewCell"> <div style="text-align:left;width:100%;font-style:italic;">Payload:</div> <div id="PktViewLength" class="PktViewCell"> <div class="PktViewFieldLabel">Length</div> <span id="lblPktLength"> 1-byte </span> </div> <div id="PktViewAddress" class="PktViewCell"> <div class="PktViewFieldLabel">Address</div> 1-byte </div> <div id="PktViewEncrypted" class="PktViewCell"> <div style="text-align:left;width:100%;font-style:italic;">Encrypted:</div> <div id="PktViewMsg" class="PktViewCell"> <div class="PktViewFieldLabel">Message</div> <span id="lblPktMsgLen">upto 64</span> bytes </div> <div id="PktViewPadding" class="PktViewCell"> <div class="PktViewFieldLabel">padding</div> <span id="lblPktPadLen">upto 15</span> * '00' </div> </div> </div> <div id="PktViewCrc" class="PktViewCell"> <div class="PktViewFieldLabel">CRC</div> 2-byte </div> </div> </div> <figcaption>Packet structure</figcaption> </figure> <h2>Packet Engine</h2> <div class="InputDiv"> <label for="selPktFifoFillCondition">FIFO Fill Condition</label> <select id="selPktFifoFillCondition" name="fifo_fill_condition" required> <option value="0" selected>On SyncAddress interrupt</option> <option value="1">If FifoFillCondition is set</option> </select> </div> <div class="InputDiv"> <label for="selPktTxStartCondition">TX Start Condition</label> <select id="selPktTxStartCondition" name="tx_start_condition" required> <option value="0">Fifo byte count &gt; Fifo Threshold</option> <option value="1" selected>Fifo byte count &gt; 0</option> </select> </div> <div class="InputDiv"> <label for="inpPktFifoThreshold">FifoLevel Interrupt Threshold</label> <input id="inpPktFifoThreshold" name="fifo_threshold" type="number" min="0" max="127" value="15" required> </div> <div class="InputDiv"> <label for="selPktInterPacketRxDelay">Inter-packet RX Delay</label> <select id="selPktInterPacketRxDelay" name="inter_packet_rx_delay" required> <!-- Filled based on Bit rate--> </select> </div> <div class="InputDiv"> <label for="cbxPktAutoRxRestartOn">Auto Restart RX after InterPacketRxDelay</label> <input id="cbxPktAutoRxRestartOn" name="auto_rx_restart_on" type="checkbox" checked> </div> <h2>Auto Modes</h2> <div class="InputDiv"> <label for="cbxPktAutoModesOn">Enable Auto Modes</label> <input id="cbxPktAutoModesOn" name="auto_modes_on" type="checkbox"> </div> <div id="settingsAutoModes"> <div class="InputDiv"> <label for="selAMEnterCondition">Enter Condition</label> <select id="selAMEnterCondition" name="am_enter_condition" required> <option value disabled selected style="display:none"></option> <option value="1">Rising edge of FifoNotEmpty</option> <option value="2">Rising edge of FifoLevel</option> <option value="3">Rising edge of CrcOk</option> <option value="4">Rising edge of PayloadReady</option> <option value="5">Rising edge of SyncAddress</option> <option value="6">Rising edge of PacketSent</option> <option value="7">Falling edge of FifoNotEmpty (i.e. FIFO empty)</option> </select> </div> <div class="InputDiv"> <label for="selAMExitCondition">Exit Condition</label> <select id="selAMExitCondition" name="am_exit_condition" required> <option value disabled selected style="display:none"></option> <option value="1">Falling edge of FifoNotEmpty (i.e. FIFO empty)</option> <option value="2">Rising edge of FifoLevel or Timeout</option> <option value="3">Rising edge of CrcOk or Timeout</option> <option value="4">Rising edge of PayloadReady or Timeout</option> <option value="5">Rising edge of SyncAddress or Timeout</option> <option value="6">Rising edge of PacketSent</option> <option value="7">Rising edge of Timeout</option> </select> </div> <div class="InputDiv"> <label for="selAMIntermediateMode">Intermediate Mode</label> <select id="selAMIntermediateMode" name="am_intermediate_mode" required> <option value="0" selected>Sleep mode (SLEEP)</option> <option value="1">Standby mode (STDBY)</option> <option value="2">Receiver mode (RX)</option> <option value="3">Transmitter mode (TX)</option> </select> </div> </div> </div> <div class="page"> <h1>Digital I/O Pin Mapping</h1> <h2>Clock Out</h2> <div class="InputDiv"> <label for="selDioClkOut">CLKOUT frequency</label> <select id="selDioClkOut" name="clk_out" required> <!-- Filled based on FXOSC --> </select> </div> <h2>DIO0</h2> <table class="DioTable ContModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_0_mapping_cont" value="0" checked></td><td>- </td><td>- </td><td>PllLock </td><td>SyncAddress </td><td>PllLock</td></tr> <tr><td><input type="radio" name="dio_0_mapping_cont" value="1"></td><td>- </td><td>- </td><td>- </td><td>Timeout </td><td>TxReady</td></tr> <tr><td><input type="radio" name="dio_0_mapping_cont" value="2"></td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>Rssi </td><td>LowBat</td></tr> <tr><td><input type="radio" name="dio_0_mapping_cont" value="3"></td><td>ModeReady </td><td>ModeReady </td><td>ModeReady </td><td>ModeReady </td><td>ModeReady</td></tr> </tbody> </table> <table class="DioTable PktModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_0_mapping_pkt" value="0" checked></td><td>- </td><td>- </td><td>- </td><td>CrcOk </td><td>PacketSent</td></tr> <tr><td><input type="radio" name="dio_0_mapping_pkt" value="1"></td><td>- </td><td>- </td><td>- </td><td>PayloadReady </td><td>TxReady</td></tr> <tr><td><input type="radio" name="dio_0_mapping_pkt" value="2"></td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>SyncAddress </td><td>LowBat</td></tr> <tr><td><input type="radio" name="dio_0_mapping_pkt" value="3"></td><td>- </td><td>- </td><td>PllLock </td><td>Rssi </td><td>PllLock</td></tr> </tbody> </table> <h2>DIO1</h2> <table class="DioTable ContModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_1_mapping_cont" value="0" checked></td><td>- </td><td>- </td><td>- </td><td>Dclk </td><td>Dclk</td></tr> <tr><td><input type="radio" name="dio_1_mapping_cont" value="1"></td><td>- </td><td>- </td><td>- </td><td>RxReady </td><td>TxReady</td></tr> <tr><td><input type="radio" name="dio_1_mapping_cont" value="2"></td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>LowBat</td></tr> <tr><td><input type="radio" name="dio_1_mapping_cont" value="3"></td><td>- </td><td>- </td><td>PllLock </td><td>SyncAddress </td><td>PllLock</td></tr> </tbody> </table> <table class="DioTable PktModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_1_mapping_pkt" value="0" checked></td><td>FifoLevel </td><td>FifoLevel </td><td>FifoLevel </td><td>FifoLevel </td><td>FifoLevel</td></tr> <tr><td><input type="radio" name="dio_1_mapping_pkt" value="1"></td><td>FifoFull </td><td>FifoFull </td><td>FifoFull </td><td>FifoFull </td><td>FifoFull</td></tr> <tr><td><input type="radio" name="dio_1_mapping_pkt" value="2"></td><td>FifoNotEmpty </td><td>FifoNotEmpty </td><td>FifoNotEmpty </td><td>FifoNotEmpty </td><td>FifoNotEmpty</td></tr> <tr><td><input type="radio" name="dio_1_mapping_pkt" value="3"></td><td>- </td><td>- </td><td>PllLock </td><td>Timeout </td><td>PllLock</td></tr> </tbody> </table> <h2>DIO2</h2> <table class="DioTable ContModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_2_mapping_cont" value="0" checked></td><td> - </td><td> - </td><td> - </td><td> Data </td><td> Data </td></tr> <tr><td><input type="radio" name="dio_2_mapping_cont" value="1"></td><td> - </td><td> - </td><td> - </td><td> Data </td><td> Data </td></tr> <tr><td><input type="radio" name="dio_2_mapping_cont" value="2"></td><td> - </td><td> - </td><td> - </td><td> Data </td><td> Data </td></tr> <tr><td><input type="radio" name="dio_2_mapping_cont" value="3"></td><td> - </td><td> - </td><td> - </td><td> Data </td><td> Data </td></tr> </tbody> </table> <table class="DioTable PktModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_2_mapping_pkt" value="0" checked></td><td>FifoNotEmpty </td><td>FifoNotEmpty </td><td>FifoNotEmpty </td><td>FifoNotEmpty </td><td>FifoNotEmpty</td></tr> <tr><td><input type="radio" name="dio_2_mapping_pkt" value="1"></td><td>- </td><td>- </td><td>- </td><td>Data </td><td>Data</td></tr> <tr><td><input type="radio" name="dio_2_mapping_pkt" value="2"></td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>LowBat</td></tr> <tr><td><input type="radio" name="dio_2_mapping_pkt" value="3"></td><td>AutoMode </td><td>AutoMode </td><td>AutoMode </td><td>AutoMode </td><td>AutoMode</td></tr> </tbody> </table> <h2>DIO3</h2> <table class="DioTable ContModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_3_mapping_cont" value="0" checked></td><td>- </td><td>- </td><td>- </td><td>Rssi </td><td>TxReady</td></tr> <tr><td><input type="radio" name="dio_3_mapping_cont" value="1"></td><td>- </td><td>- </td><td>- </td><td>RxReady </td><td>TxReady</td></tr> <tr><td><input type="radio" name="dio_3_mapping_cont" value="2"></td><td>AutoMode </td><td>AutoMode </td><td>AutoMode </td><td>AutoMode </td><td>AutoMode</td></tr> <tr><td><input type="radio" name="dio_3_mapping_cont" value="3"></td><td>- </td><td>- </td><td>- </td><td>Timeout </td><td>TxReady</td></tr> </tbody> </table> <table class="DioTable PktModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_3_mapping_pkt" value="0" checked></td><td>FifoFull </td><td>FifoFull </td><td>FifoFull </td><td>FifoFull </td><td>FifoFull</td></tr> <tr><td><input type="radio" name="dio_3_mapping_pkt" value="1"></td><td>- </td><td>- </td><td>- </td><td>Rssi </td><td>TxReady</td></tr> <tr><td><input type="radio" name="dio_3_mapping_pkt" value="2"></td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>SyncAddress </td><td>LowBat</td></tr> <tr><td><input type="radio" name="dio_3_mapping_pkt" value="3"></td><td>- </td><td>- </td><td>PllLock </td><td>PllLock </td><td>PllLock</td></tr> </tbody> </table> <h2>DIO4</h2> <table class="DioTable ContModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_4_mapping_cont" value="0" checked></td><td>- </td><td>- </td><td>- </td><td>Timeout </td><td>TxReady</td></tr> <tr><td><input type="radio" name="dio_4_mapping_cont" value="1"></td><td>- </td><td>- </td><td>- </td><td>RxReady </td><td>TxReady</td></tr> <tr><td><input type="radio" name="dio_4_mapping_cont" value="2"></td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>SyncAddress </td><td>LowBat </td></tr> <tr><td><input type="radio" name="dio_4_mapping_cont" value="3"></td><td>- </td><td>- </td><td>PllLock </td><td>PllLock </td><td>PllLock</td></tr> </tbody> </table> <table class="DioTable PktModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_4_mapping_pkt" value="0" checked></td><td>- </td><td>- </td><td>- </td><td>Timeout </td><td>ModeReady</td></tr> <tr><td><input type="radio" name="dio_4_mapping_pkt" value="1"></td><td>- </td><td>- </td><td>- </td><td>Rssi </td><td>TxReady</td></tr> <tr><td><input type="radio" name="dio_4_mapping_pkt" value="2"></td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>RxReady </td><td>LowBat</td></tr> <tr><td><input type="radio" name="dio_4_mapping_pkt" value="3"></td><td>- </td><td>- </td><td>PllLock </td><td>PllLock </td><td>PllLock</td></tr> </tbody> </table> <h2>DIO5</h2> <table class="DioTable ContModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_5_mapping_cont" value="0" checked></td><td>- </td><td>ClkOut </td><td>ClkOut </td><td>ClkOut </td><td>ClkOut</td></tr> <tr><td><input type="radio" name="dio_5_mapping_cont" value="1"></td><td>- </td><td>- </td><td>- </td><td>Rssi </td><td>ClkOut</td></tr> <tr><td><input type="radio" name="dio_5_mapping_cont" value="2"></td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>LowBat</td></tr> <tr><td><input type="radio" name="dio_5_mapping_cont" value="3"></td><td>ModeReady </td><td>ModeReady </td><td>ModeReady</td><td>ModeReady</td><td>ModeReady</td></tr> </tbody> </table> <table class="DioTable PktModeOnly"> <thead> <th><!-- Radio Button --></th> <th>Sleep</th> <th>Stdby</th> <th>FS</th> <th>RX</th> <th>TX</th> </thead> <tbody> <tr><td><input type="radio" name="dio_5_mapping_pkt" value="0" checked></td><td>- </td><td>ClkOut </td><td>ClkOut </td><td>ClkOut </td><td>ClkOut</td></tr> <tr><td><input type="radio" name="dio_5_mapping_pkt" value="1"></td><td>- </td><td>- </td><td>- </td><td>Data </td><td>Data</td></tr> <tr><td><input type="radio" name="dio_5_mapping_pkt" value="2"></td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>LowBat </td><td>LowBat</td></tr> <tr><td><input type="radio" name="dio_5_mapping_pkt" value="3"></td><td>ModeReady </td><td>ModeReady </td><td>ModeReady </td><td>ModeReady </td><td>ModeReady</td></tr> </tbody> </table> </div> <div class="page hidden"> <h1>Startup Timing</h1> <!-- TODO: --> </div> <div class="page"> <h1>Spectrum</h1> <figure> <!-- TODO: - LEGEND: red = blocked by RX Band filter, blue = blocked by AFC band filer - bandwidth of OOK is currently the cos^2() bw, don't know if this is correct... - Modulation shaping is completly left out - DCC filtering not visible --> <svg id="svgSpectrum" height="450" width="100%"> <defs> <clippath id="clip-neg"> <rect x="0" y="0" width="50%" height="100%"/> </clippath> <clippath id="clip-pos"> <rect x="50%" y="0" width="100%" height="100%"/> </clippath> </defs> <line id="lineXAxis" x1="0" y1="392" x2="100%" y2="392" stroke="black" stroke-width="2" fill="none"/> <line id="lineYAxis" x1="50%" y1="0" x2="50%" y2="392" stroke="black" stroke-width="2" fill="none"/> <path id="curvePosRight" d="" stroke="blue" stroke-width="5" fill="none" clip-path="url(#clip-pos)"/> <path id="curvePosLeft" d="" stroke="blue" stroke-width="5" fill="none" clip-path="url(#clip-pos)"/> <path id="curveNegRight" d="" stroke="blue" stroke-width="5" fill="none" clip-path="url(#clip-neg)"/> <path id="curveNegLeft" d="" stroke="blue" stroke-width="5" fill="none" clip-path="url(#clip-neg)"/> <rect id="rectRxFiltNeg" x="0" y="0" width="0" height="390" fill="coral" fill-opacity="0.2"/> <rect id="rectRxFiltPos" x="100%" y="0" width="100%" height="390" fill="coral" fill-opacity="0.2"/> <rect id="rectAfcFiltNeg" x="0" y="0" width="0" height="390" fill="blue" fill-opacity="0.2"/> <rect id="rectAfcFiltPos" x="100%" y="0" width="100%" height="390" fill="blue" fill-opacity="0.2"/> <polygon id="arrowBWLeft" points="100,430 110,425 107.5,430 110,435"/> <polygon id="arrowBWRight" points="400,430 390,425 392.5,430 390,435"/> <line id="lineBW" x1="105" y1="430" x2="395" y2="430" stroke="black" stroke-width="2"/> <g stroke="black" stroke-width="2" stroke-dasharray="2"> <line id="lineBWMarkLeft" x1="0" y1="390" x2="0" y2="180" class="OOKOnly"/> <line id="lineBWMarkRight" x1="0" y1="390" x2="0" y2="180" class="OOKOnly"/> <line id="lineFreqLow" x1="125" y1="390" x2="125" y2="10" class="FSKOnly"/> <line id="lineFreqHigh" x1="375" y1="390" x2="375" y2="10" class="FSKOnly"/> </g> <g font-size="16" font-family="sans-serif" fill="black" stroke="none" text-anchor="middle"> <text id="lblFreqLow" x="125" y="390" dy="1em"/> <text id="lblFreqHigh" x="375" y="390" dy="1em" class="FSKOnly"/> <text id="lblFreqBWLow" x="125" y="390" dy="2em"/> <text id="lblFreqBWHigh" x="375" y="390" dy="2em"/> <text id="lblBW20dB" x="50%" y="430" dy="1em"/> </g> Your browser does not support inline SVG. </svg> <div style="text-align:center;margin:20px auto;"> Legend: <svg height="1em" width="1em"><rect width="100%" height="100%" fill="coral" fill-opacity=".2"/></svg> = Filtered by RX filter <svg height="1em" width="1em"><rect width="100%" height="100%" fill="#00f" fill-opacity=".2"/></svg> = Filtered by AFC filter </div> <figcaption style="text-align:center;">Artist impression of power spectral density.<br> (NOTE: This is in no way a complete or accurate simulation of the PSD.)</figcaption> </figure> </div> <div class="page"> <h1>Register values</h1> <div> <button id="btnRegExport" type="button">Export</button> <button id="btnRegImport" type="button">Import</button> </div> <textarea id="txtRegVal" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="width:100%;min-height:300px">
  </textarea> </div> </form> <div id="pageRegistersDebug"> <table id="tblRegisterDebugView" style="border-collapse:collapse"> <thead> <th>Addr</th> <th>Value</th> <th>Prev.</th> <th>POR</th> </thead> <tbody> </tbody> </table> </div> <div id="divCopyright"> &copy; <span id="spnCopyrightText"> License: MIT | Copyright 2019 David Imhoff | Version: 0.1 </span> </div> <script>"use strict";const formElements=document.getElementById("frmSettings");const AES_BLOCK_SIZE=16;const MOD_FSK=0;const MOD_OOK=1;const MODE_PCKT=0;const MODE_CONT=1;const FMT_FIXED_LEN=0;const FMT_VAR_LEN=1;const FMT_UNLIMITED_LEN=2;const ENC_NONE=0;const ENC_MANCHESTER=1;const ENC_WHITENING=2;const ADDR_FILT_NONE=0;const ADDR_FILT_NODE=1;const ADDR_FILT_NODE_BCAST=2;const POR_REGS={0:0,1:4,2:0,3:26,4:11,5:0,6:82,7:228,8:192,9:0,10:65,11:0,12:2,13:146,14:245,15:32,16:35,17:159,18:9,19:26,20:64,21:176,22:123,23:155,24:8,25:134,26:138,27:64,28:128,29:6,30:16,31:0,32:0,33:0,34:0,35:2,36:255,37:0,38:5,39:128,40:0,41:255,42:0,43:0,44:0,45:3,46:152,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:16,56:64,57:0,58:0,59:0,60:15,61:2,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:1,79:0,88:27,89:9,95:8,111:0,113:0};function bToHexStr(val){if(val<16)return"0"+Number(val).toString(16);return Number(val).toString(16)}function showByClassName(className){for(const el of document.getElementsByClassName(className)){el.classList.remove("hidden")}}function hideByClassName(className){for(const el of document.getElementsByClassName(className)){el.classList.add("hidden")}}function formUpdateDisabledByVisibility(form){for(const el of form){if(el.offsetParent===null){el.disabled=true}else{el.disabled=false}}}function formEnableAll(form){for(const el of form){el.disabled=false}}function toggleModulationSettings(){const isFSK=formElements["modulation"].value==MOD_FSK;if(isFSK){showByClassName("FSKOnly");hideByClassName("OOKOnly")}else{showByClassName("OOKOnly");hideByClassName("FSKOnly")}}function updateModulationShapingOptions(){const el=formElements["modulation_shaping"];const modulation=formElements["modulation"].value;let optionTexts=null;if(modulation==MOD_FSK){optionTexts=["Gaussian filter, BT = 1.0","Gaussian filter, BT = 0.5","Gaussian filter, BT = 0.3"]}else{optionTexts=["Filtering with f_cutoff = BR","Filtering with f_cutoff = 2*BR"]}const oldValue=el.value;el.options.length=0;let optionNone=document.createElement("OPTION");optionNone.value=0;optionNone.text="No Shaping";el.appendChild(optionNone);for(let i=0;i<optionTexts.length;i++){let newOption=document.createElement("OPTION");newOption.value=i+1;newOption.text=optionTexts[i];el.appendChild(newOption)}if(oldValue){el.value=oldValue}else{el.value="0"}el.checkValidity()}function toggleOcpSettings(){const el=document.getElementById("settingsTXOCP");const ocp_on=formElements["ocp_on"].checked;if(ocp_on===true){el.classList.remove("hidden")}else{el.classList.add("hidden")}}function toggleLowBetaSettings(){const el=document.getElementById("settingsLowBeta");const value=parseInt(formElements["modulation_index"].value);if(value<2){el.style.display=null}else{el.style.display="none"}}function toggleAfcLowBetaSettings(){const el=document.getElementById("settingsAfcLowBeta");const value=formElements["afc_low_beta_on"].checked;if(value===true){el.classList.remove("hidden")}else{el.classList.add("hidden")}}function toggleOokThresholdSettings(){const peakSettingsEl=document.getElementById("settingsOokPeakThreshold");const avgSettingsEl=document.getElementById("settingsOokAverageThreshold");const fixedSettingsEl=document.getElementById("settingsOokFixedThreshold");const value=parseInt(formElements["ook_thresh_type"].value);switch(value){case 0:fixedSettingsEl.style.display=null;peakSettingsEl.style.display="none";avgSettingsEl.style.display="none";break;case 1:fixedSettingsEl.style.display="none";peakSettingsEl.style.display=null;avgSettingsEl.style.display="none";break;case 2:fixedSettingsEl.style.display="none";peakSettingsEl.style.display="none";avgSettingsEl.style.display=null;break;default:fixedSettingsEl.style.display="none";peakSettingsEl.style.display="none";avgSettingsEl.style.display="none";break}}function updateFStep(){const el=formElements["fstep"];const fxo=parseFloat(formElements["fxo"].value)*1e6;el.value=fxo/Math.pow(2,19);el.dispatchEvent(new Event("change"))}function updateModulationIndex(){const freqDev=parseFloat(formElements["fdev"].value)*1e3;const bitRate=parseFloat(formElements["bit_rate"].value);const elemModIndex=formElements["modulation_index"];const newValue=2*freqDev/bitRate;elemModIndex.value=newValue;elemModIndex.dispatchEvent(new Event("change"));if(newValue<.5||newValue>10){elemModIndex.setCustomValidity("beta should be >= 0.5 and <= 10")}else{elemModIndex.setCustomValidity("")}}function updatePaPowerMax(){const el=formElements["pa_power"];const txPin=parseInt(formElements["tx_pin_select"].value);if(txPin){el.max=17}else{el.max=13}el.value=el.value;el.checkValidity()}function updateRxBwOptions(){const el=formElements["rx_bw"];const afcEl=formElements["afc_bw"];const fxo=parseFloat(formElements["fxo"].value)*1e6;const calcRxBw=(fxo,rxBwMant,rxBwExp)=>{return fxo/(rxBwMant*Math.pow(2,rxBwExp+2))};const oldValue=el.value;const oldAfcValue=el.value;el.options.length=0;afcEl.options.length=0;for(let rxBwExp=8;rxBwExp>=0;rxBwExp--){for(const rxBwMant of[24,20,16]){let newOption=document.createElement("OPTION");newOption.value=rxBwMant+";"+rxBwExp;newOption.text=Math.round(calcRxBw(fxo,rxBwMant,rxBwExp))/1e3;el.appendChild(newOption);afcEl.appendChild(newOption.cloneNode(true))}}if(oldValue){el.value=oldValue}else{el.value="24;5"}if(oldAfcValue){afcEl.value=oldAfcValue}else{afcEl.value="20;3"}toggleRxBwOptions()}function toggleRxBwOptions(){const el=formElements["rx_bw"];const afcEl=formElements["afc_bw"];const modulation=formElements["modulation"].value;const optionCount=el.options.length;for(let i=0;i<3;i++){el.options[i].disabled=modulation==MOD_FSK;el.options[optionCount-1-i].disabled=modulation!=MOD_FSK;afcEl.options[i].disabled=modulation==MOD_FSK;afcEl.options[optionCount-1-i].disabled=modulation!=MOD_FSK}checkBw(el);checkBw(afcEl)}function toggleDataModeSettings(){const mode=formElements["data_mode"].value;if(mode==MODE_PCKT){showByClassName("PktModeOnly");hideByClassName("ContModeOnly")}else{showByClassName("ContModeOnly");hideByClassName("PktModeOnly")}}function toggleSyncWordSettings(){const el=document.getElementById("syncWordSettings");const value=formElements["sync_on"].checked;if(value){el.style.display=null}else{el.style.display="none"}}function updateSyncValueLimits(){const el=formElements["sync_value"];const syncSize=parseFloat(formElements["sync_size"].value);if(formElements["sync_size"].validity.valid){el.minLength=0;el.maxLength=syncSize*2;el.minLength=syncSize*2;el.pattern="([0-9A-Fa-f]{2}){"+syncSize+"}";el.value=el.value;el.checkValidity()}}function checkSyncValue(){const el=formElements["sync_value"];el.setCustomValidity("");if(!el.validity.valid)return;let isValid=true;for(let i=0;i<el.value.length;i+=2){if(el.value.substr(i,2)==="00"){isValid=false;break}}if(!isValid){el.setCustomValidity("Sync Word may not contain a 0x00 byte")}}function updatePayloadMsgLenLimits(){const el=formElements["payload_msg_len"];const pktFmt=parseInt(formElements["packet_format"].value);const aesOn=formElements["aes_on"].checked;const addrFiltOn=formElements["address_filtering"].value!=ADDR_FILT_NONE;let maxLen=0;if(aesOn){maxLen=64;if(pktFmt==FMT_VAR_LEN&&addrFiltOn){maxLen=48}}else{maxLen=255;if(pktFmt==FMT_VAR_LEN){maxLen-=1}if(addrFiltOn){maxLen-=1}}el.max=maxLen;if(addrFiltOn){el.min=0}else{el.min=1}el.checkValidity()}function togglePacketFormatSettings(){const pktLenSettings=document.getElementById("pktLenSettings");const varLenLabel=document.getElementById("lblPktLenVar");const fixLenLabel=document.getElementById("lblPktLenFixed");const crcTxOnlyLabel=document.getElementById("lblCrcTxOnly");const pktFmt=parseInt(formElements["packet_format"].value);switch(pktFmt){case FMT_FIXED_LEN:varLenLabel.style.display="none";fixLenLabel.style.display=null;crcTxOnlyLabel.style.display="none";pktLenSettings.classList.remove("hidden");break;case FMT_VAR_LEN:varLenLabel.style.display=null;fixLenLabel.style.display="none";crcTxOnlyLabel.style.display="none";pktLenSettings.classList.remove("hidden");break;case FMT_UNLIMITED_LEN:crcTxOnlyLabel.style.display=null;pktLenSettings.classList.add("hidden");break;default:throw new Error("Invalid value of packet_format select")}}function toggleUnlimitedLengthConstraintSettings(){const pktFmt=parseInt(formElements["packet_format"].value);if(pktFmt==FMT_UNLIMITED_LEN){hideByClassName("hideIfUnlimitedLen");const syncOn=formElements["sync_on"].checked;if(syncOn){showByClassName("hideIfUnlimitedLenWithoutSync")}else{hideByClassName("hideIfUnlimitedLenWithoutSync")}}else{showByClassName("hideIfUnlimitedLen");showByClassName("hideIfUnlimitedLenWithoutSync")}}function togglePktCrcSettings(){const el=document.getElementById("pktCrcSettings");const crcOn=formElements["crc_on"].checked;if(crcOn){el.style.display=null}else{el.style.display="none"}}function togglePktAddrFiltSettings(){const nodeAddrSettings=document.getElementById("pktNodeAddrSettings");const bcastAddrSettings=document.getElementById("pktBcastAddrSettings");const filterMode=parseInt(formElements["address_filtering"].value);if(filterMode==ADDR_FILT_NODE_BCAST){bcastAddrSettings.style.display=null}else{bcastAddrSettings.style.display="none"}if(filterMode==ADDR_FILT_NODE||filterMode==ADDR_FILT_NODE_BCAST){nodeAddrSettings.style.display=null}else{nodeAddrSettings.style.display="none"}}function togglePktAesSettings(){const el=document.getElementById("pktAesSettings");const aesOn=formElements["aes_on"].checked;if(aesOn){el.style.display=null}else{el.style.display="none"}}function updateInterPacketRxDelayOptions(){const el=formElements["inter_packet_rx_delay"];const bitRate=parseFloat(formElements["bit_rate"].value);const bitTime=1e3/bitRate;const oldValue=el.value;el.options.length=0;let optionNone=document.createElement("OPTION");optionNone.value=12;optionNone.text="No Delay";el.appendChild(optionNone);for(let i=0;i<12;i++){let newOption=document.createElement("OPTION");const multiplier=Math.pow(2,i);const ival=multiplier*bitTime;newOption.value=i;if(ival<100){newOption.text=ival.toPrecision(2)+" ms"}else{newOption.text=Math.round(ival)+" ms"}newOption.text+=" / "+multiplier+" bit time(s)";el.appendChild(newOption)}if(oldValue){el.value=oldValue}else{el.value="0"}}function toggleAutoModesSettings(){const el=document.getElementById("settingsAutoModes");const value=formElements["auto_modes_on"].checked;if(value){el.style.display=null}else{el.style.display="none"}}function updateClkOutOptions(){const el=formElements["clk_out"];const fxo=parseFloat(formElements["fxo"].value)*1e6;const calcClkOut=(fxo,clkOut)=>{return fxo/Math.pow(2,clkOut)};const oldValue=el.value;el.options.length=0;for(let clkOut=0;clkOut<6;clkOut++){let newOption=document.createElement("OPTION");newOption.value=clkOut;newOption.text=Math.round(calcClkOut(fxo,clkOut)/1e3)/1e3+" MHz";el.appendChild(newOption)}let optionRC=document.createElement("OPTION");optionRC.value=6;optionRC.text="62.5 kHz (RC Oscillator)";el.appendChild(optionRC);let optionNone=document.createElement("OPTION");optionNone.value=7;optionNone.text="Disabled";el.appendChild(optionNone);if(oldValue){el.value=oldValue}else{el.value="7"}}function checkBw(el){if(el instanceof Event){el=el.target}if(el.options[el.selectedIndex].disabled){el.setCustomValidity("The current options is not avalable for the selected modulation type")}else{el.setCustomValidity("")}}function updateMaxBitRate(){const el=formElements["wanted_bit_rate"];const modulation=formElements["modulation"].value;if(modulation==MOD_FSK){el.max=300}else{el.max=32.768}el.checkValidity()}function updateActualBitRate(){const el=formElements["bit_rate"];const fxo=parseFloat(formElements["fxo"].value)*1e6;const wantedBitRate=parseFloat(formElements["wanted_bit_rate"].value)*1e3;el.value=fxo/Math.round(fxo/wantedBitRate);el.dispatchEvent(new Event("change"))}function dioSelectionChange(evt){const el=evt.target;let parentTable=el.parentNode;while(parentTable!=null&&parentTable.tagName.toUpperCase()!=="TABLE"){parentTable=parentTable.parentNode}if(parentTable){updateDioTableSelection(parentTable)}}function updateDioTableSelection(table){let body=table.tBodies[0];for(const row of body.rows){const button=row.cells[0].childNodes[0];if(button.checked){row.classList.add("selected")}else{row.classList.remove("selected")}}}function dioTableRowClick(evt){const row=evt.currentTarget;const button=row.getElementsByTagName("INPUT")[0];if(button&&!button.checked){button.checked=true;button.dispatchEvent(new Event("change"))}}function checkCarrierFreq(){const el=formElements["carrier_freq"];el.setCustomValidity("");if(!el.validity.valid)return;const valueMHz=parseFloat(el.value);if(!(valueMHz>=290&&valueMHz<=340||valueMHz>=424&&valueMHz<=510||valueMHz>=862&&valueMHz<=1020)){el.setCustomValidity("Value must be in one of these ranges: 290-340, 424-510, 862-1020")}}function updateCarrierFreqMax(){const el=formElements["carrier_freq"];const fxo=parseFloat(formElements["fxo"].value)*1e6;const fstep=fxo/Math.pow(2,19);const calcMax=Math.floor(fstep*16777215/1e6);if(calcMax<1020){el.max=calcMax}else{el.max=1020}console.log(calcMax);el.value=el.value;el.checkValidity()}function updatePktView(){const pktFmt=parseInt(formElements["packet_format"].value);const preambleSize=formElements["preamble_size"].value;document.getElementById("lblPktPreambleLen").innerText=preambleSize;if(preambleSize==0){document.getElementById("PktViewPreamble").style.display="none"}else{document.getElementById("PktViewPreamble").style.display=null}const syncOn=formElements["sync_on"].checked;const syncValue=formElements["sync_value"].value;let syncValueStr="";for(let i=0;i<syncValue.length;i+=2){syncValueStr+="0x"+syncValue.substr(i,2)+" "}document.getElementById("lblPktSyncValue").innerText=syncValueStr;if(syncOn){document.getElementById("PktViewSync").style.display=null}else{document.getElementById("PktViewSync").style.display="none"}let encoding=formElements["encoding"].value;if(pktFmt==FMT_UNLIMITED_LEN&&!syncOn){encoding=ENC_NONE}const pktViewEncodedEl=document.getElementById("PktViewEncoded");if(encoding==ENC_NONE){pktViewEncodedEl.style.display="none";pktViewEncodedEl.after(document.getElementById("PktViewCrc"));pktViewEncodedEl.after(document.getElementById("PktViewPayload"))}else{pktViewEncodedEl.style.display=null;pktViewEncodedEl.appendChild(document.getElementById("PktViewPayload"));pktViewEncodedEl.appendChild(document.getElementById("PktViewCrc"));if(encoding==ENC_MANCHESTER){document.getElementById("lblPktEncoding").innerText="Manchester Encoding"}else{document.getElementById("lblPktEncoding").innerText="Data Whitening"}}let payloadHdrLen=0;if(pktFmt==FMT_VAR_LEN){document.getElementById("PktViewLength").style.display=null}else{document.getElementById("PktViewLength").style.display="none"}let addrFilt=formElements["address_filtering"].value;if(pktFmt==FMT_UNLIMITED_LEN&&!syncOn){addrFilt=ADDR_FILT_NONE}if(addrFilt==ADDR_FILT_NONE){document.getElementById("PktViewAddress").style.display="none"}else{document.getElementById("PktViewAddress").style.display=null;payloadHdrLen++}const payloadMsgLen=parseFloat(formElements["payload_msg_len"].value);if(payloadMsgLen==0){document.getElementById("PktViewMsg").style.display="none";document.getElementById("PktViewEncrypted").style.display="none"}else{if(pktFmt==FMT_VAR_LEN){document.getElementById("lblPktMsgLen").innerText="upto "+payloadMsgLen}else if(pktFmt==FMT_UNLIMITED_LEN){document.getElementById("lblPktMsgLen").innerText="..."}else{document.getElementById("lblPktMsgLen").innerText=payloadMsgLen}let aesOn=formElements["aes_on"].checked;if(pktFmt==FMT_UNLIMITED_LEN){aesOn=false}if(aesOn){const paddedPayloadLen=Math.ceil(payloadMsgLen/AES_BLOCK_SIZE)*AES_BLOCK_SIZE;const payloadPadLen=paddedPayloadLen-payloadMsgLen;if(pktFmt==FMT_VAR_LEN){document.getElementById("lblPktPadLen").innerText="upto 15"}else{document.getElementById("lblPktPadLen").innerText=payloadPadLen}document.getElementById("PktViewEncrypted").style.display=null;document.getElementById("PktViewPadding").before(document.getElementById("PktViewMsg"));if(pktFmt!=FMT_VAR_LEN&&payloadPadLen==0){document.getElementById("PktViewPadding").style.display="none"}else{document.getElementById("PktViewPadding").style.display=null}}else{document.getElementById("PktViewEncrypted").style.display="none";document.getElementById("PktViewEncrypted").before(document.getElementById("PktViewMsg"))}document.getElementById("PktViewMsg").style.display=null}if(formElements["crc_on"].checked){document.getElementById("PktViewCrc").style.display=null}else{document.getElementById("PktViewCrc").style.display="none"}}function updateSvgFskSpectrum(){const modFsk=formElements["modulation"].value==MOD_FSK;const carrierFreq=parseFloat(formElements["carrier_freq"].value)*1e6;let freqDev=0;if(modFsk){freqDev=parseFloat(formElements["fdev"].value)*1e3}const bitRate=parseFloat(formElements["bit_rate"].value);const rxBW=parseFloat(formElements["rx_bw"].options[formElements["rx_bw"].selectedIndex].text)*1e3;const afcBW=parseFloat(formElements["afc_bw"].options[formElements["afc_bw"].selectedIndex].text)*1e3;const svgEl=document.getElementById("svgSpectrum");const xZero=svgEl.getBoundingClientRect().width/2;const xMaxPos=svgEl.getBoundingClientRect().width-50;const xMaxNeg=50;const yZero=390;const yMax=10;let relXCoords={};let bandwidth=0;if(modFsk){relXCoords["mainPeak"]=0;relXCoords["firstLow"]=bitRate/2;relXCoords["secondPeak"]=relXCoords["firstLow"]+bitRate/4;relXCoords["secondLow"]=relXCoords["secondPeak"]+bitRate/4;relXCoords["thirdPeak"]=relXCoords["secondLow"]+bitRate/4;relXCoords["thirdLow"]=relXCoords["thirdPeak"]+bitRate/4;bandwidth=Math.round(2*freqDev+bitRate)}else{relXCoords["mainPeak"]=0;relXCoords["firstLow"]=bitRate;relXCoords["secondPeak"]=relXCoords["firstLow"]+bitRate/2;relXCoords["secondLow"]=relXCoords["secondPeak"]+bitRate/2;relXCoords["thirdPeak"]=relXCoords["secondLow"]+bitRate/2;relXCoords["thirdLow"]=relXCoords["thirdPeak"]+bitRate/2;bandwidth=Math.round(bitRate)}relXCoords["rxFilterStart"]=rxBW;relXCoords["afcFilterStart"]=afcBW;let furthestPoint=freqDev+bitRate/2;if(rxBW>furthestPoint){furthestPoint=rxBW}if(afcBW>furthestPoint){furthestPoint=afcBW}const scale=(xMaxPos-xZero)/furthestPoint;let genCurve=function(side,direction){let x={};for(const key in relXCoords){x[key]=xZero+side*freqDev*scale+direction*(relXCoords[key]*scale)}const attackMainPeak=direction*bitRate/2*.5*scale;const attackMainLow=direction*bitRate/2*.5*scale;const attackPeak=direction*bitRate/4*.5*scale;const attackLow=direction*bitRate/4*.5*scale;return"M "+x["mainPeak"]+" "+yMax+" C "+(x["mainPeak"]+attackMainPeak)+" "+yMax+" , "+(x["firstLow"]-attackLow)+" "+yZero+" , "+x["firstLow"]+" "+yZero+" S "+(x["secondPeak"]-attackPeak)+" "+(yZero+(yMax-yZero)*.1)+" , "+x["secondPeak"]+" "+(yZero+(yMax-yZero)*.1)+" S "+(x["secondLow"]-attackLow)+" "+yZero+" , "+x["secondLow"]+" "+yZero+" S "+(x["thirdPeak"]-attackPeak)+" "+(yZero+(yMax-yZero)*.05)+" , "+x["thirdPeak"]+" "+(yZero+(yMax-yZero)*.05)+" S "+(x["thirdLow"]-attackLow)+" "+yZero+" , "+x["thirdLow"]+" "+yZero};document.getElementById("curvePosRight").setAttribute("d",genCurve(1,1));document.getElementById("curvePosLeft").setAttribute("d",genCurve(1,-1));document.getElementById("curveNegRight").setAttribute("d",genCurve(-1,1));document.getElementById("curveNegLeft").setAttribute("d",genCurve(-1,-1));document.getElementById("rectRxFiltPos").setAttribute("x",xZero+relXCoords["rxFilterStart"]*scale);document.getElementById("rectRxFiltNeg").setAttribute("width",xZero-relXCoords["rxFilterStart"]*scale);document.getElementById("rectAfcFiltPos").setAttribute("x",xZero+relXCoords["afcFilterStart"]*scale);document.getElementById("rectAfcFiltNeg").setAttribute("width",xZero-relXCoords["afcFilterStart"]*scale);document.getElementById("lblFreqLow").innerHTML=((carrierFreq-freqDev)/1e6).toFixed(3);document.getElementById("lblFreqLow").setAttribute("x",xZero-freqDev*scale);document.getElementById("lineFreqLow").setAttribute("x1",xZero-freqDev*scale);document.getElementById("lineFreqLow").setAttribute("x2",xZero-freqDev*scale);document.getElementById("lblFreqHigh").innerHTML=((carrierFreq+freqDev)/1e6).toFixed(3);document.getElementById("lblFreqHigh").setAttribute("x",xZero+freqDev*scale);document.getElementById("lineFreqHigh").setAttribute("x1",xZero+freqDev*scale);document.getElementById("lineFreqHigh").setAttribute("x2",xZero+freqDev*scale);document.getElementById("lblFreqBWLow").innerHTML=((carrierFreq-bandwidth/2)/1e6).toFixed(3);document.getElementById("lblFreqBWLow").setAttribute("x",xZero-bandwidth/2*scale);document.getElementById("lblFreqBWHigh").innerHTML=((carrierFreq+bandwidth/2)/1e6).toFixed(3);document.getElementById("lblFreqBWHigh").setAttribute("x",xZero+bandwidth/2*scale);if(!modFsk){document.getElementById("lineBWMarkLeft").setAttribute("x1",xZero-bandwidth/2*scale);document.getElementById("lineBWMarkLeft").setAttribute("x2",xZero-bandwidth/2*scale);document.getElementById("lineBWMarkRight").setAttribute("x1",xZero+bandwidth/2*scale);document.getElementById("lineBWMarkRight").setAttribute("x2",xZero+bandwidth/2*scale)}document.getElementById("lblBW20dB").innerHTML="BW = "+bandwidth/1e3+" kHz";const calcArrowPoints=(xPoint,yCenter,direction)=>{return xPoint+","+yCenter+" "+(xPoint+direction*10)+","+(yCenter-5)+" "+(xPoint+direction*7.5)+","+yCenter+" "+(xPoint+direction*10)+","+(yCenter+5)};document.getElementById("arrowBWLeft").setAttribute("points",calcArrowPoints(xZero-(freqDev+bitRate/2)*scale,430,1));document.getElementById("arrowBWRight").setAttribute("points",calcArrowPoints(xZero+(freqDev+bitRate/2)*scale,430,-1));document.getElementById("lineBW").setAttribute("x1",xZero-(freqDev+bitRate/2)*scale+2);document.getElementById("lineBW").setAttribute("x2",xZero+(freqDev+bitRate/2)*scale-2)}function importRegValues(){const form=document.getElementById("frmSettings");const lines=document.getElementById("txtRegVal").value.split("\n");let regs={};for(let i=0;i<lines.length;i++){const line=lines[i].trim();if(line===""){continue}const regexMatch=line.match(/^([0-9a-fA-F]{2})\s+([0-9a-fA-F]{2})$/);if(!regexMatch){throw new Error("Line "+(i+1)+": Syntax Error")}const addr=parseInt(regexMatch[1],16);if(addr<0||addr>255){throw new Error("Line "+(i+1)+": Address out of range")}const val=parseInt(regexMatch[2],16);if(val<0||val>255){throw new Error("Line "+(i+1)+": Value out of range")}regs[addr]=val}const fxOsc=parseFloat(formElements["fxo"].value)*1e6;const fstep=fxOsc/Math.pow(2,19);let val;if(2 in regs){switch(regs[2]>>3&3){case 0:formElements["modulation"].value=MOD_FSK;break;case 1:formElements["modulation"].value=MOD_OOK;break;default:throw new Error("[0x02.ModulationType] Invalid Value")}formElements["modulation"].dispatchEvent(new Event("change"));formElements["modulation_shaping"].value=regs[2]&3;formElements["modulation_shaping"].dispatchEvent(new Event("change"));formElements["bit_sync_on"].checked=true;switch(regs[2]>>5&3){case 0:formElements["data_mode"].value=MODE_PCKT;break;case 3:formElements["bit_sync_on"].checked=false;case 2:formElements["data_mode"].value=MODE_CONT;break;default:throw new Error("[0x02.DataMode] Invalid Value")}formElements["bit_sync_on"].dispatchEvent(new Event("change"))}if(3 in regs&&4 in regs){if(regs[3]+regs[4]===0){throw new Error("[0x03-0x04] Invalid bitrate")}formElements["wanted_bit_rate"].value=Math.round(fxOsc/(regs[3]<<8|regs[4]))/1e3;formElements["wanted_bit_rate"].dispatchEvent(new Event("change"))}if(5 in regs&&6 in regs){formElements["fdev"].value=Math.round(fstep*(regs[5]<<8|regs[6]))/1e3;formElements["fdev"].dispatchEvent(new Event("change"))}if(7 in regs&&8 in regs&&9 in regs){formElements["carrier_freq"].value=Math.round(fstep*(regs[7]<<16|regs[8]<<8|regs[9]))/1e6;formElements["carrier_freq"].dispatchEvent(new Event("change"))}if(10 in regs){formElements["afc_low_beta_on"].checked=regs[10]&32;formElements["afc_low_beta_on"].dispatchEvent(new Event("change"))}if(17 in regs){if(regs[17]&128){formElements["tx_pin_select"].value=0}else{formElements["tx_pin_select"].value=1}let paPower=-18+(regs[17]&31);if(regs[17]&32){paPower+=4}formElements["pa_power"].value=paPower;formElements["pa_power"].dispatchEvent(new Event("change"));formElements["tx_pin_select"].dispatchEvent(new Event("change"))}if(18 in regs){formElements["pa_ramp"].value=regs[18]&15;formElements["pa_ramp"].dispatchEvent(new Event("change"))}if(19 in regs){formElements["ocp_on"].checked=regs[19]&16;formElements["ocp_on"].dispatchEvent(new Event("change"));formElements["ocp_imax"].value=45+5*(regs[19]&15);formElements["ocp_imax"].dispatchEvent(new Event("change"))}if(24 in regs){formElements["lna_gain_select"].value=regs[24]&7;formElements["lna_gain_select"].dispatchEvent(new Event("change"));formElements["lna_zin"].value=regs[24]&128?1:0;formElements["lna_zin"].dispatchEvent(new Event("change"))}if(25 in regs){let rxBwMant=0;switch(regs[25]>>3&3){case 0:rxBwMant=16;break;case 1:rxBwMant=20;break;case 2:rxBwMant=24;break;default:throw new Error("[0x19.RxBwMant] Invalid value")}formElements["rx_bw"].value=rxBwMant+";"+(regs[25]&7);formElements["rx_bw"].dispatchEvent(new Event("change"));formElements["dcc_freq"].value=regs[25]>>>5&7;formElements["dcc_freq"].dispatchEvent(new Event("change"))}if(26 in regs){let rxBwMant=0;switch(regs[26]>>3&3){case 0:rxBwMant=16;break;case 1:rxBwMant=20;break;case 2:rxBwMant=24;break;default:throw new Error("[0x1a.RxBwMant] Invalid value")}formElements["afc_bw"].value=rxBwMant+";"+(regs[26]&7);formElements["afc_bw"].dispatchEvent(new Event("change"));formElements["dcc_freq_afc"].value=regs[26]>>>5&7;formElements["dcc_freq_afc"].dispatchEvent(new Event("change"))}if(27 in regs){formElements["ook_thresh_type"].value=regs[27]>>>6&3;formElements["ook_thresh_type"].dispatchEvent(new Event("change"));formElements["ook_peak_thresh_step"].value=regs[27]>>>3&7;formElements["ook_peak_thresh_step"].dispatchEvent(new Event("change"));formElements["ook_peak_thresh_dec"].value=regs[27]&7;formElements["ook_peak_thresh_dec"].dispatchEvent(new Event("change"))}if(28 in regs){formElements["ook_average_thresh_fit"].value=regs[28]>>>6&3;formElements["ook_average_thresh_fit"].dispatchEvent(new Event("change"))}if(29 in regs){formElements["ook_peak_thresh_floor"].value=formElements["ook_fixed_thresh"].value=regs[29];formElements["ook_peak_thresh_floor"].dispatchEvent(new Event("change"));formElements["ook_fixed_thresh"].dispatchEvent(new Event("change"))}if(30 in regs){formElements["afc_auto_on"].checked=regs[30]&4;formElements["afc_auto_on"].dispatchEvent(new Event("change"));formElements["afc_auto_clear_on"].checked=regs[30]&8;formElements["afc_auto_clear_on"].dispatchEvent(new Event("change"))}if(37 in regs){val=regs[37]>>>6&3;formElements["dio_0_mapping_cont"].value=val;formElements["dio_0_mapping_pkt"].value=val;formElements["dio_0_mapping_cont"][val].dispatchEvent(new Event("change"));formElements["dio_0_mapping_pkt"][val].dispatchEvent(new Event("change"));val=regs[37]>>>4&3;formElements["dio_1_mapping_cont"].value=val;formElements["dio_1_mapping_pkt"].value=val;formElements["dio_1_mapping_cont"][val].dispatchEvent(new Event("change"));formElements["dio_1_mapping_pkt"][val].dispatchEvent(new Event("change"));val=regs[37]>>>2&3;formElements["dio_2_mapping_cont"].value=val;formElements["dio_2_mapping_pkt"].value=val;formElements["dio_2_mapping_cont"][val].dispatchEvent(new Event("change"));formElements["dio_2_mapping_pkt"][val].dispatchEvent(new Event("change"));val=regs[37]&3;formElements["dio_3_mapping_cont"].value=val;formElements["dio_3_mapping_pkt"].value=val;formElements["dio_3_mapping_cont"][val].dispatchEvent(new Event("change"));formElements["dio_3_mapping_pkt"][val].dispatchEvent(new Event("change"))}if(38 in regs){val=regs[38]>>>6&3;formElements["dio_4_mapping_cont"].value=val;formElements["dio_4_mapping_pkt"].value=val;formElements["dio_4_mapping_cont"][val].dispatchEvent(new Event("change"));formElements["dio_4_mapping_pkt"][val].dispatchEvent(new Event("change"));val=regs[38]>>>4&3;formElements["dio_5_mapping_cont"].value=val;formElements["dio_5_mapping_pkt"].value=val;formElements["dio_5_mapping_cont"][val].dispatchEvent(new Event("change"));formElements["dio_5_mapping_pkt"][val].dispatchEvent(new Event("change"));formElements["clk_out"].value=regs[38]&7}formElements["rssi_threshold"].value=regs[41]/-2;formElements["rssi_threshold"].dispatchEvent(new Event("change"));if(44 in regs&&45 in regs){formElements["preamble_size"].value=regs[44]<<8|regs[45];formElements["preamble_size"].dispatchEvent(new Event("change"))}if(46 in regs){formElements["sync_on"].checked=regs[46]&128;formElements["sync_on"].dispatchEvent(new Event("change"));formElements["fifo_fill_condition"].value=regs[46]>>>6&1;formElements["fifo_fill_condition"].dispatchEvent(new Event("change"));formElements["sync_size"].value=1+(regs[46]>>>3&7);formElements["sync_size"].dispatchEvent(new Event("change"));formElements["sync_tol"].value=regs[46]&7;formElements["sync_tol"].dispatchEvent(new Event("change"))}if(formElements["sync_on"].checked){const syncSize=parseInt(formElements["sync_size"].value);let syncValue="";let setValue=false;for(let i=0;i<syncSize;i++){if(47+i in regs){setValue=true;syncValue+=bToHexStr(regs[47+i])}else{syncValue+="01"}}if(setValue){formElements["sync_value"].value=syncValue;formElements["sync_value"].dispatchEvent(new Event("change"))}}if(55 in regs){formElements["address_filtering"].value=regs[55]>>>1&3;formElements["address_filtering"].dispatchEvent(new Event("change"));formElements["encoding"].value=regs[55]>>>5&3;formElements["encoding"].dispatchEvent(new Event("change"));if(regs[55]&128){formElements["packet_format"].value=FMT_VAR_LEN}else{formElements["packet_format"].value=FMT_FIXED_LEN}formElements["packet_format"].dispatchEvent(new Event("change"));formElements["crc_on"].checked=regs[55]&16;formElements["crc_on"].dispatchEvent(new Event("change"));formElements["crc_auto_clear_off"].checked=regs[55]&8;formElements["crc_auto_clear_off"].dispatchEvent(new Event("change"))}if(56 in regs){const payloadLen=regs[56];const pktFmt=formElements["packet_format"].value;if(pktFmt==FMT_FIXED_LEN&&payloadLen==0){formElements["packet_format"].value=FMT_UNLIMITED_LEN;formElements["packet_format"].dispatchEvent(new Event("change"))}let payloadMsgLen=payloadLen;if(formElements["address_filtering"].value!=ADDR_FILT_NONE){payloadMsgLen-=1}if(pktFmt==FMT_VAR_LEN){payloadMsgLen-=1}formElements["payload_msg_len"].value=payloadMsgLen;formElements["payload_msg_len"].dispatchEvent(new Event("change"))}if(57 in regs){formElements["node_address"].value=regs[57];formElements["node_address"].dispatchEvent(new Event("change"))}if(58 in regs){formElements["broadcast_address"].value=regs[58];formElements["broadcast_address"].dispatchEvent(new Event("change"))}if(59 in regs){const enterCondition=regs[59]>>>5&7;const exitCondition=regs[59]>>>2&7;formElements["auto_modes_on"].checked=enterCondition!==0&&exitCondition!==0;formElements["auto_modes_on"].dispatchEvent(new Event("change"));formElements["am_enter_condition"].value=enterCondition;formElements["am_enter_condition"].dispatchEvent(new Event("change"));formElements["am_exit_condition"].value=exitCondition;formElements["am_exit_condition"].dispatchEvent(new Event("change"));formElements["am_intermediate_mode"].value=regs[59]&3;formElements["am_intermediate_mode"].dispatchEvent(new Event("change"))}if(60 in regs){formElements["tx_start_condition"].value=regs[60]>>>7&1;formElements["tx_start_condition"].dispatchEvent(new Event("change"));formElements["fifo_threshold"].value=regs[60]&127;formElements["fifo_threshold"].dispatchEvent(new Event("change"))}if(61 in regs){formElements["inter_packet_rx_delay"].value=regs[61]>>>4;formElements["inter_packet_rx_delay"].dispatchEvent(new Event("change"));formElements["auto_rx_restart_on"].checked=regs[61]&2;formElements["auto_rx_restart_on"].dispatchEvent(new Event("change"));formElements["aes_on"].checked=regs[61]&1;formElements["aes_on"].dispatchEvent(new Event("change"))}if(62 in regs&&63 in regs&&64 in regs&&65 in regs&&66 in regs&&67 in regs&&68 in regs&&69 in regs&&70 in regs&&71 in regs&&72 in regs&&73 in regs&&74 in regs&&75 in regs&&76 in regs&&77 in regs){let aesKey="";for(let addr=62;addr<=77;addr++){aesKey+=bToHexStr(regs[addr])}formElements["aes_key"].value=aesKey;formElements["aes_key"].dispatchEvent(new Event("change"));aesKey=undefined}if(88 in regs){formElements["sensitivity_boost"].checked=regs[88]==45}if(89 in regs){formElements["tcxo_input_on"].checked=regs[89]&16}if(111 in regs){formElements["dagc_on"].checked=regs[111]!=0}if(113 in regs){formElements["low_beta_afc_offset"].value=regs[113]*488}}function generateRegValues(){const regs={};const fxOsc=parseFloat(formElements["fxo"].value)*1e6;const fstep=fxOsc/Math.pow(2,19);const mod=parseInt(formElements["modulation"].value);const pktFmt=parseInt(formElements["packet_format"].value);const dataMode=parseInt(formElements["data_mode"].value);const addrFilt=formElements["address_filtering"].disabled?ADDR_FILT_NONE:parseInt(formElements["address_filtering"].value);regs[2]=parseInt(formElements["modulation_shaping"].value);if(dataMode==MODE_CONT){regs[2]|=64;if(!formElements["bit_sync_on"].checked){regs[2]|=32}}if(mod==MOD_OOK){regs[2]|=8}const bitrate=Math.round(fxOsc/parseFloat(formElements["bit_rate"].value));regs[3]=bitrate>>>8&255;regs[4]=bitrate&255;if(mod==MOD_FSK){const fdev=Math.round(parseFloat(formElements["fdev"].value)*1e3/fstep);regs[5]=fdev>>>8&63;regs[6]=fdev&255}const fcarrier=Math.round(parseFloat(formElements["carrier_freq"].value)*1e6/fstep);regs[7]=fcarrier>>>16&255;regs[8]=fcarrier>>>8&255;regs[9]=fcarrier&255;const afcLowBetaOn=!formElements["afc_low_beta_on"].disabled&&formElements["afc_low_beta_on"].checked;if(afcLowBetaOn){regs[11]=32}else{regs[11]=0}let paPower=parseFloat(formElements["pa_power"].value);if(formElements["tx_pin_select"].value==0){regs[17]=128}else{regs[17]=64}if(paPower>13){paPower-=4;regs[17]|=32}regs[17]|=paPower+18&31;regs[18]=parseInt(formElements["pa_ramp"].value)&15;if(formElements["ocp_on"].checked){regs[19]=16;regs[19]|=Math.round((parseFloat(formElements["ocp_imax"].value)-45)/5)&15}else{regs[19]=10}regs[24]=parseInt(formElements["lna_gain_select"].value)&7;regs[24]|=8;if(formElements["lna_zin"].value==1){regs[24]|=128}const rxBwParts=formElements["rx_bw"].value.split(";");if(rxBwParts.length!=2){throw new Error("Invalid RxBw value format")}let rxBwMant=0;switch(parseInt(rxBwParts[0])){case 16:rxBwMant=0;break;case 20:rxBwMant=1;break;case 24:rxBwMant=2;break;default:throw new Error("Invalid RxBw Mant.")}const rxBwExp=parseInt(rxBwParts[1]);regs[25]=parseInt(formElements["dcc_freq"].value)<<5|rxBwMant<<3|rxBwExp&7;const afcBwParts=formElements["afc_bw"].value.split(";");if(afcBwParts.length!=2){throw new Error("Invalid AfcBw value format")}let afcBwMant=0;switch(parseInt(afcBwParts[0])){case 16:afcBwMant=0;break;case 20:afcBwMant=1;break;case 24:afcBwMant=2;break;default:throw new Error("Invalid AfcBw Mant.")}const afcBwExp=parseInt(afcBwParts[1]);regs[26]=parseInt(formElements["dcc_freq_afc"].value)<<5|afcBwMant<<3|afcBwExp&7;if(mod==MOD_OOK){const ookThreshType=parseInt(formElements["ook_thresh_type"].value);regs[27]=ookThreshType<<6;if(ookThreshType==1){regs[27]|=parseInt(formElements["ook_peak_thresh_step"].value)<<3;regs[27]|=parseInt(formElements["ook_peak_thresh_dec"].value)}if(ookThreshType==2){regs[28]=parseInt(formElements["ook_average_thresh_fit"].value)<<6}if(ookThreshType==1){regs[29]=parseFloat(formElements["ook_peak_thresh_floor"].value)&255}else if(ookThreshType==0){regs[29]=parseFloat(formElements["ook_fixed_thresh"].value)&255}}regs[30]=16;if(formElements["afc_auto_on"].checked){regs[30]|=4}if(formElements["afc_auto_clear_on"].checked){regs[30]|=8}const modeSuffix=dataMode==MODE_PCKT?"pkt":"cont";regs[37]=parseInt(formElements["dio_0_mapping_"+modeSuffix].value)<<6|parseInt(formElements["dio_1_mapping_"+modeSuffix].value)<<4|parseInt(formElements["dio_2_mapping_"+modeSuffix].value)<<2|parseInt(formElements["dio_3_mapping_"+modeSuffix].value);regs[38]=parseInt(formElements["dio_4_mapping_"+modeSuffix].value)<<6|parseInt(formElements["dio_5_mapping_"+modeSuffix].value)<<4|parseInt(formElements["clk_out"].value);regs[41]=parseFloat(formElements["rssi_threshold"].value)*-2;if(dataMode==MODE_PCKT){const preambleLen=parseFloat(formElements["preamble_size"].value);regs[44]=preambleLen>>8;regs[45]=preambleLen&255;let syncSize=0;if(formElements["sync_on"].checked){syncSize=parseFloat(formElements["sync_size"].value);regs[46]=128;regs[46]|=(syncSize-1&7)<<3;regs[46]|=parseFloat(formElements["sync_tol"].value)&7}else{regs[46]=24}if(formElements["fifo_fill_condition"].value!=0){regs[46]|=64}const syncValue=formElements["sync_value"].value;for(let i=0;i<syncSize;i++){regs[47+i]=parseInt(syncValue.substr(i*2,2),16)}regs[55]=addrFilt<<1;if(!formElements["encoding"].disabled){regs[55]|=parseInt(formElements["encoding"].value)<<5}if(pktFmt==FMT_VAR_LEN){regs[55]|=128}if(formElements["crc_on"].checked){regs[55]|=16}if(!formElements["crc_auto_clear_off"].disabled&&formElements["crc_auto_clear_off"].checked){regs[55]|=8}if(pktFmt==FMT_UNLIMITED_LEN){regs[56]=0}else{let payloadLen=parseFloat(formElements["payload_msg_len"].value);if(addrFilt!=ADDR_FILT_NONE){payloadLen+=1}if(pktFmt==FMT_VAR_LEN){payloadLen+=1}regs[56]=payloadLen}if(addrFilt!=ADDR_FILT_NONE){regs[57]=parseInt(formElements["node_address"].value)}if(addrFilt==ADDR_FILT_NODE_BCAST){regs[58]=parseInt(formElements["broadcast_address"].value)}if(formElements["auto_modes_on"].checked){regs[59]=formElements["am_intermediate_mode"].value&3;regs[59]|=(formElements["am_exit_condition"].value&7)<<2;regs[59]|=(formElements["am_enter_condition"].value&7)<<5}regs[60]=parseFloat(formElements["fifo_threshold"].value)&127;if(formElements["tx_start_condition"].value==1){regs[60]|=128}regs[61]=parseInt(formElements["inter_packet_rx_delay"].value)<<4;if(formElements["auto_rx_restart_on"].checked){regs[61]|=2}const aesOn=!formElements["aes_on"].disabled&&formElements["aes_on"].checked;if(aesOn){regs[61]|=1}if(aesOn){let aesKey=formElements["aes_key"].value;for(let i=0;i<16;i++){regs[62+i]=parseInt(aesKey.substr(2*i,2),16)}aesKey=undefined}}if(formElements["sensitivity_boost"].checked){regs[88]=45}else{regs[88]=27}regs[89]=9;if(formElements["tcxo_input_on"].checked){regs[89]|=16}if(formElements["dagc_on"].checked){if(afcLowBetaOn){regs[111]=32}else{regs[111]=48}}else{regs[111]=0}if(afcLowBetaOn){const afcOffset=parseFloat(formElements["low_beta_afc_offset"].value);regs[113]=Math.round(afcOffset/488)}return regs}var prevRegs=POR_REGS;function updateRegisterDebugView(){const form=document.getElementById("frmSettings");const table=document.getElementById("tblRegisterDebugView");const newBody=document.createElement("TBODY");formUpdateDisabledByVisibility(form);if(form.checkValidity()==false){table.replaceChild(newBody,table.tBodies[0]);return}const regs=generateRegValues();formEnableAll(form);for(let addr=0;addr<256;addr++){if(addr in POR_REGS||addr in regs||addr in prevRegs){const newRow=newBody.insertRow(-1);let newCell=null;newCell=newRow.insertCell(-1);newCell.innerText=bToHexStr(addr);newCell=newRow.insertCell(-1);if(addr in regs){newCell.innerText=bToHexStr(regs[addr])}newCell=newRow.insertCell(-1);if(addr in prevRegs){newCell.innerText=bToHexStr(prevRegs[addr])}newCell=newRow.insertCell(-1);if(addr in POR_REGS){newCell.innerText=bToHexStr(POR_REGS[addr])}if(prevRegs[addr]!=regs[addr]){newRow.classList.add("highlight")}}}table.replaceChild(newBody,table.tBodies[0]);prevRegs=regs}function exportRegValues(){const form=document.getElementById("frmSettings");formUpdateDisabledByVisibility(form);if(form.checkValidity()==false){for(const el of formElements){if(!el.disabled&&!el.validity.valid){el.value=el.value;el.scrollIntoView();el.focus();break}}return}const regs=generateRegValues();for(const addr in regs){if(regs[addr]==POR_REGS[addr]){delete regs[addr]}}let regDump="";for(const addr in regs){regDump+=bToHexStr(addr)+" "+bToHexStr(regs[addr])+"\n"}document.getElementById("txtRegVal").value=regDump;formEnableAll(form)}function init(){let elemInpRadioCarrierFreq=document.getElementById("inpRadioCarrierFreq");document.getElementById("inpFXO").addEventListener("change",updateFStep);updateFStep();formElements["modulation"].addEventListener("change",toggleModulationSettings);toggleModulationSettings();formElements["carrier_freq"].addEventListener("change",checkCarrierFreq);checkCarrierFreq();formElements["fstep"].addEventListener("change",updateCarrierFreqMax);updateCarrierFreqMax();formElements["fdev"].addEventListener("change",updateModulationIndex);formElements["bit_rate"].addEventListener("change",updateModulationIndex);updateModulationIndex();formElements["tx_pin_select"].addEventListener("change",updatePaPowerMax);updatePaPowerMax();formElements["modulation"].addEventListener("change",updateModulationShapingOptions);updateModulationShapingOptions();formElements["ocp_on"].addEventListener("change",toggleOcpSettings);toggleOcpSettings();formElements["modulation_index"].addEventListener("change",toggleLowBetaSettings);toggleLowBetaSettings();formElements["afc_low_beta_on"].addEventListener("change",toggleAfcLowBetaSettings);toggleAfcLowBetaSettings();formElements["fxo"].addEventListener("change",updateRxBwOptions);updateRxBwOptions();formElements["modulation"].addEventListener("change",toggleRxBwOptions);formElements["rx_bw"].addEventListener("change",checkBw);formElements["afc_bw"].addEventListener("change",checkBw);formElements["ook_thresh_type"].addEventListener("change",toggleOokThresholdSettings);toggleOokThresholdSettings();formElements["modulation"].addEventListener("change",updateMaxBitRate);updateMaxBitRate();formElements["fxo"].addEventListener("change",updateActualBitRate);formElements["wanted_bit_rate"].addEventListener("change",updateActualBitRate);updateActualBitRate();formElements["modulation"].addEventListener("change",updateSvgFskSpectrum);formElements["carrier_freq"].addEventListener("change",updateSvgFskSpectrum);formElements["fdev"].addEventListener("change",updateSvgFskSpectrum);formElements["bit_rate"].addEventListener("change",updateSvgFskSpectrum);formElements["rx_bw"].addEventListener("change",updateSvgFskSpectrum);formElements["afc_bw"].addEventListener("change",updateSvgFskSpectrum);window.addEventListener("resize",updateSvgFskSpectrum);updateSvgFskSpectrum();formElements["data_mode"].addEventListener("change",toggleDataModeSettings);toggleDataModeSettings();formElements["packet_format"].addEventListener("change",togglePacketFormatSettings);togglePacketFormatSettings();formElements["packet_format"].addEventListener("change",toggleUnlimitedLengthConstraintSettings);formElements["sync_on"].addEventListener("change",toggleUnlimitedLengthConstraintSettings);toggleUnlimitedLengthConstraintSettings();formElements["sync_size"].addEventListener("change",updateSyncValueLimits);updateSyncValueLimits();formElements["sync_on"].addEventListener("change",toggleSyncWordSettings);toggleSyncWordSettings();formElements["sync_value"].addEventListener("change",checkSyncValue);checkSyncValue();formElements["packet_format"].addEventListener("change",updatePayloadMsgLenLimits);formElements["aes_on"].addEventListener("change",updatePayloadMsgLenLimits);formElements["address_filtering"].addEventListener("change",updatePayloadMsgLenLimits);updatePayloadMsgLenLimits();formElements["crc_on"].addEventListener("change",togglePktCrcSettings);togglePktCrcSettings();formElements["address_filtering"].addEventListener("change",togglePktAddrFiltSettings);togglePktAddrFiltSettings();formElements["aes_on"].addEventListener("change",togglePktAesSettings);togglePktAesSettings();formElements["preamble_size"].addEventListener("change",updatePktView);formElements["sync_on"].addEventListener("change",updatePktView);formElements["sync_value"].addEventListener("change",updatePktView);formElements["encoding"].addEventListener("change",updatePktView);formElements["packet_format"].addEventListener("change",updatePktView);formElements["address_filtering"].addEventListener("change",updatePktView);formElements["node_address"].addEventListener("change",updatePktView);formElements["broadcast_address"].addEventListener("change",updatePktView);formElements["payload_msg_len"].addEventListener("change",updatePktView);formElements["aes_on"].addEventListener("change",updatePktView);formElements["crc_on"].addEventListener("change",updatePktView);updatePktView();formElements["bit_rate"].addEventListener("change",updateInterPacketRxDelayOptions);updateInterPacketRxDelayOptions();formElements["auto_modes_on"].addEventListener("change",toggleAutoModesSettings);toggleAutoModesSettings();formElements["fxo"].addEventListener("change",updateClkOutOptions);updateClkOutOptions();for(const table of document.getElementsByClassName("DioTable")){for(const row of table.tBodies[0].rows){row.addEventListener("click",dioTableRowClick)}for(const input of table.getElementsByTagName("INPUT")){input.addEventListener("change",dioSelectionChange)}updateDioTableSelection(table)}document.getElementById("btnRegImport").addEventListener("click",importRegValues);document.getElementById("btnRegExport").addEventListener("click",exportRegValues);document.getElementById("txtRegVal").value="";const form=document.getElementById("frmSettings");form.addEventListener("change",updateRegisterDebugView);updateRegisterDebugView()}init();</script> </body> </html> 
